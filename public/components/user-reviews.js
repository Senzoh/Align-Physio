// components/user-reviews.js

export const allReviews = [
  // Acupuncture
  {
    message: "Acupuncture really helped my migraines.",
    name: "Sarah M.",
    stars: 5,
    date: "2025-05-28",
    category: "acupuncture"
  },
  {
    message: "I was skeptical at first, but acupuncture helped ease my chronic lower back pain without the need for medication.",
    name: "Mark D.",
    stars: 4,
    date: "2025-05-16",
    category: "acupuncture"
  },
  {
    message: "Professional and attentive service. I felt a noticeable difference in my energy levels after just two sessions.",
    name: "Ella F.",
    stars: 5,
    date: "2025-05-14",
    category: "acupuncture"
  },
  {
    message: "My physiotherapist explained everything clearly and made me feel completely at ease during my first acupuncture experience.",
    name: "Tom W.",
    stars: 4,
    date: "2025-05-12",
    category: "acupuncture"
  },
  {
    message: "Acupuncture helped reduce my jaw tension from bruxism and I’m sleeping much better now. A great investment in my wellbeing.",
    name: "Sophia K.",
    stars: 5,
    date: "2025-05-09",
    category: "acupuncture"
  },
  {
    message: "I noticed a big improvement in my menstrual cramps and overall mood. Acupuncture has become part of my monthly routine.",
    name: "Zara B.",
    stars: 5,
    date: "2025-05-06",
    category: "acupuncture"
  },

  // Massage
  {
    message: "The deep tissue massage worked wonders for my stiff shoulders. I left the clinic feeling looser and lighter.",
    name: "Henry J.",
    stars: 5,
    date: "2025-05-22",
    category: "massage"
  },
  {
    message: "Very relaxing atmosphere and my therapist listened carefully to where I needed focus. Will definitely return.",
    name: "Natalie C.",
    stars: 4,
    date: "2025-05-19",
    category: "massage"
  },
  {
    message: "My legs were sore after a marathon, and this massage helped me recover quickly. Really impressed!",
    name: "Leo S.",
    stars: 5,
    date: "2025-05-17",
    category: "massage"
  },
  {
    message: "I’ve had many massages before, but this one was by far the most therapeutic. Great technique and pressure.",
    name: "Jasmin E.",
    stars: 5,
    date: "2025-05-15",
    category: "massage"
  },
  {
    message: "Perfect balance of relaxation and pain relief. My back pain reduced significantly after a few sessions.",
    name: "Andre V.",
    stars: 4,
    date: "2025-05-11",
    category: "massage"
  },
  {
    message: "Booked a massage for stress relief and walked out feeling reset. The environment was clean and calming.",
    name: "Fiona L.",
    stars: 5,
    date: "2025-05-07",
    category: "massage"
  },

  // Cupping
  {
    message: "I had tension between my shoulder blades, and cupping released it better than anything else I’ve tried.",
    name: "Michelle T.",
    stars: 5,
    date: "2025-05-20",
    category: "cupping"
  },
  {
    message: "The therapist explained the process thoroughly. The marks faded quickly and the results were incredible!",
    name: "Ali H.",
    stars: 4,
    date: "2025-05-18",
    category: "cupping"
  },
  {
    message: "Cupping helped drain fluid and reduce tightness in my legs post-workout. Definitely a fan now.",
    name: "Julian K.",
    stars: 5,
    date: "2025-05-14",
    category: "cupping"
  },
  {
    message: "I booked cupping for neck stiffness. It felt strange at first, but the relief was real and long-lasting.",
    name: "Rachel Z.",
    stars: 4,
    date: "2025-05-12",
    category: "cupping"
  },
  {
    message: "After a stressful week, cupping helped reset my body. My back hasn’t felt this good in years.",
    name: "Gemma R.",
    stars: 5,
    date: "2025-05-10",
    category: "cupping"
  },
  {
    message: "Cupping therapy is now part of my regular routine. Great results and thoughtful treatment every time.",
    name: "David N.",
    stars: 5,
    date: "2025-05-08",
    category: "cupping"
  },

  // PNF Stretching
  {
    message: "The therapist guided me through stretches I didn’t know my body needed. I felt looser immediately.",
    name: "Sophie M.",
    stars: 5,
    date: "2025-05-21",
    category: "pnf stretching"
  },
  {
    message: "This technique helped unlock tightness in my hips that foam rolling never fixed. Super effective.",
    name: "Ian R.",
    stars: 5,
    date: "2025-05-18",
    category: "pnf stretching"
  },
  {
    message: "PNF stretching made a huge difference in my posture and flexibility. I felt taller afterward.",
    name: "Maria P.",
    stars: 4,
    date: "2025-05-15",
    category: "pnf stretching"
  },
  {
    message: "Very detailed and hands-on approach. I felt immediate improvements in my shoulder range.",
    name: "Eric W.",
    stars: 5,
    date: "2025-05-13",
    category: "pnf stretching"
  },
  {
    message: "Perfect for my rehab journey. I gained more mobility with these stretches than I expected.",
    name: "Linda F.",
    stars: 4,
    date: "2025-05-11",
    category: "pnf stretching"
  },
  {
    message: "The therapist knew exactly how far to push me safely. I left the session energized and loose.",
    name: "Darren C.",
    stars: 5,
    date: "2025-05-08",
    category: "pnf stretching"
  },

  // Complete Physical Assessment
  {
    message: "The assessment was extremely thorough. I learned more about my posture and movement than ever before.",
    name: "Leah S.",
    stars: 5,
    date: "2025-05-27",
    category: "complete physical assessment"
  },
  {
    message: "They picked up on muscle imbalances I never noticed. Felt like a total body tune-up.",
    name: "Ben A.",
    stars: 5,
    date: "2025-05-24",
    category: "complete physical assessment"
  },
  {
    message: "Very professional and educational. The report helped me understand why my knee was bothering me.",
    name: "Tina O.",
    stars: 4,
    date: "2025-05-22",
    category: "complete physical assessment"
  },
  {
    message: "The therapist gave me two treatments after the assessment that targeted exactly what I needed.",
    name: "Malik G.",
    stars: 5,
    date: "2025-05-20",
    category: "complete physical assessment"
  },
  {
    message: "I left with a plan and a clear understanding of my body’s strengths and weaknesses.",
    name: "Isla V.",
    stars: 5,
    date: "2025-05-18",
    category: "complete physical assessment"
  },
  {
    message: "Super helpful if you don’t know what treatment you need. It pointed me in the right direction.",
    name: "Chris B.",
    stars: 4,
    date: "2025-05-15",
    category: "complete physical assessment"
  },

  // Rehabilitation Program
  {
    message: "This program gave me structure and accountability. Weekly check-ins kept me motivated and on track.",
    name: "Holly J.",
    stars: 5,
    date: "2025-05-26",
    category: "rehabilitation program"
  },
  {
    message: "Everything was tailored to me. I made more progress in 4 weeks than I had in 4 months on my own.",
    name: "Caleb T.",
    stars: 5,
    date: "2025-05-24",
    category: "rehabilitation program"
  },
  {
    message: "My therapist adjusted the plan when I had setbacks. It was flexible and human, not rigid.",
    name: "Asha R.",
    stars: 5,
    date: "2025-05-22",
    category: "rehabilitation program"
  },
  {
    message: "I loved the combination of exercises, education, and follow-up. A full recovery system!",
    name: "Jordan E.",
    stars: 5,
    date: "2025-05-19",
    category: "rehabilitation program"
  },
  {
    message: "Easy to follow, great support, and noticeable progress every week. Highly recommend.",
    name: "Stella N.",
    stars: 4,
    date: "2025-05-17",
    category: "rehabilitation program"
  },
  {
    message: "The difference this made to my day-to-day movement was incredible. I finally feel strong again.",
    name: "Freddie M.",
    stars: 5,
    date: "2025-05-15",
    category: "rehabilitation program"
  },

  // Post-Surgery Rehabilitation
  {
    message: "After my knee surgery, this rehab plan helped me regain strength and confidence. Every session built on the last.",
    name: "Laura H.",
    stars: 5,
    date: "2025-05-29",
    category: "post surgery rehabilitation"
  },
  {
    message: "No long NHS waits — I got proper guidance and personalised support from week one.",
    name: "Mohammed A.",
    stars: 5,
    date: "2025-05-26",
    category: "post surgery rehabilitation"
  },
  {
    message: "The therapist was very responsive to pain flare-ups and adjusted things in real-time. That made all the difference.",
    name: "Amy L.",
    stars: 4,
    date: "2025-05-24",
    category: "post surgery rehabilitation"
  },
  {
    message: "I could feel myself progressing safely week by week. Great care and professional insight throughout.",
    name: "Ryan G.",
    stars: 5,
    date: "2025-05-21",
    category: "post surgery rehabilitation"
  },
  {
    message: "My surgeon was impressed with how fast I was recovering. Can’t thank them enough!",
    name: "Daniela S.",
    stars: 5,
    date: "2025-05-18",
    category: "post surgery rehabilitation"
  },
  {
    message: "Clear instructions, helpful encouragement, and solid recovery results. I’m walking comfortably again!",
    name: "Noah C.",
    stars: 5,
    date: "2025-05-15",
    category: "post surgery rehabilitation"
  }
];

function renderUserReviewComponent(container) {
  const category = container.dataset.category;
  const filtered = allReviews.filter(r => r.category === category);

  if (filtered.length < 3) {
    container.innerHTML = `<p class="text-center text-gray-600">Not enough reviews to display a carousel.</p>`;
    return;
  }

  const cardsToShow = getCardsToShow();
  const cardWidth = 100 / cardsToShow;
  let currentIndex = cardsToShow;

  const reviews = [
    ...filtered.slice(-cardsToShow),
    ...filtered,
    ...filtered.slice(0, cardsToShow)
  ];

  // Clear the container
  container.innerHTML = `
    <section class="bg-gray-50 py-16 px-4 sm:px-40 overflow-hidden">
      <h2 class="text-3xl font-bold text-center text-gray-900 mb-10">What Our Clients Say</h2>
      <div class="relative overflow-hidden max-w-6xl mx-auto">
        <div class="flex transition-transform duration-500 ease-in-out" id="carousel-track-${category}"></div>
      </div>
      <div class="flex justify-center gap-6 mt-8">
        <button class="prev-btn text-amber-500 hover:text-amber-600 font-medium">← Previous</button>
        <button class="next-btn text-amber-500 hover:text-amber-600 font-medium">Next →</button>
      </div>
    </section>
  `;

  const track = container.querySelector(`#carousel-track-${category}`);

  reviews.forEach(review => {
    const card = document.createElement("div");
    card.className = "px-3 shrink-0";
    card.style.width = `${cardWidth}%`;
    card.innerHTML = `
      <div class="bg-white rounded-lg shadow-md p-6 text-center h-[350px] flex flex-col justify-between">
        <div class="overflow-y-auto max-h-[180px] mb-4">
          <p class="text-lg text-gray-800">${review.message}</p>
        </div>
        <div>
          <div class="text-amber-500 text-xl mb-2">${"★".repeat(review.stars)}${"☆".repeat(5 - review.stars)}</div>
          <p class="font-semibold text-gray-900">${review.name}</p>
          <p class="text-sm text-gray-500">${new Date(review.date).toDateString()}</p>
        </div>
      </div>
    `;
    track.appendChild(card);
  });

  const updateTransform = () => {
    const offset = -(currentIndex * (100 / cardsToShow));
    track.style.transform = `translateX(${offset}%)`;
  };

  container.querySelector(".next-btn").onclick = () => {
    currentIndex++;
    updateTransform();
    if (currentIndex === reviews.length - cardsToShow) {
      setTimeout(() => {
        track.classList.remove("transition-transform");
        currentIndex = cardsToShow;
        updateTransform();
        void track.offsetWidth;
        track.classList.add("transition-transform");
      }, 500);
    }
  };

  container.querySelector(".prev-btn").onclick = () => {
    currentIndex--;
    updateTransform();
    if (currentIndex === 0) {
      setTimeout(() => {
        track.classList.remove("transition-transform");
        currentIndex = reviews.length - (2 * cardsToShow);
        updateTransform();
        void track.offsetWidth;
        track.classList.add("transition-transform");
      }, 500);
    }
  };

  track.classList.add("transition-transform");
  updateTransform();
}

// Responsive helper
function getCardsToShow() {
  const width = window.innerWidth;
  if (width < 640) return 1;
  if (width < 1024) return 2;
  return 3;
}

// Init once DOM is ready
document.addEventListener("DOMContentLoaded", () => {
  const carousels = document.querySelectorAll(".user-review-carousel");
  carousels.forEach(container => {
    renderUserReviewComponent(container);

    // Resize handler — debounce to avoid repeated re-renders
    let resizeTimer;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        renderUserReviewComponent(container);
      }, 300);
    });
  });
});